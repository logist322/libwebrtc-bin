on: [push]
  # schedule:
  #   - cron:  '* * * * 1'

jobs:
  check-chrome:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - run: |
          grep 'WEBRTC_SEMANTIC_VERSION' VERSION |
          cut -d'=' -f2 |
          {
            read version;
            echo 'CURRENT_VERSION=$version' >> $GITHUB_ENV;
          }

      - uses: actions/github-script@v6
        id: webrtc-commit
        with:
          script: |
            const https = require('https');

            await new Promise(resolve => {
              https.get('https://chromiumdash.appspot.com/fetch_releases?channel=Stable&platform=Linux&num=1&offset=0', (resp) => {
                let data = '';

                resp.on('data', (chunk) => {
                  data += chunk;
                });

                resp.on('end', () => {
                  resolve(data);
                });

              })
            }).then(data => {
                const commit = JSON.parse(data)[0];
                core.exportVariable('version', commit.version);
                core.exportVariable('hash', commit.hashes.webrtc);
              });

      - if: true
        run: echo '$CURRENT_VERSION'
      
      # - uses: action/github-script@v6
      #   id: version
      #   with: 
      #     script: |
      #       const version = process.env;
      #       console.log(version);